
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Regression Modeling on Argo using Scikit-learn &#8212; Using sklearn with BGC-Argo ocean observations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-pythia-theme.min.css?v=ba7ce088" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d0efeab3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-T52X8HNYE8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-T52X8HNYE8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-T52X8HNYE8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/sklearn-regression';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project Pythia Notebook Template" href="sklearn-clustering.html" />
    <link rel="prev" title="Accessing Argo Data" href="argo-access.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="14 June 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>

  
  <div class="pst-scroll-pixel-helper"></div>
    <header class="bd-header navbar navbar-dark navbar-expand-lg bg-dark fixed-top bd-navbar shadow" id="navbar-main">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

   

<a class="navbar-brand logo" href="https://projectpythia.org">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pythia_logo-white-rtext.svg" class="logo__image only-light" alt="Using sklearn with BGC-Argo ocean observations - Home"/>
    <script>document.write(`<img src="../_static/pythia_logo-white-rtext.svg" class="logo__image only-dark" alt="Using sklearn with BGC-Argo ocean observations - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><ul id="navbar-main-elements" class="navbar-nav">
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org">Home</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://foundations.projectpythia.org">Foundations</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://cookbooks.projectpythia.org">Cookbooks</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/resource-gallery.html">Resources</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/index.html#join-us">Community</a>
  </li>
  
  
</ul></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ProjectPythia" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/project_pythia" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCoZPBqJal5uKpO8ZiwzavCw" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
        
        
        
        <div class="bd-sidebar-primary bd-sidebar">
          

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item"><ul id="navbar-main-elements" class="navbar-nav">
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org">Home</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://foundations.projectpythia.org">Foundations</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://cookbooks.projectpythia.org">Cookbooks</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/resource-gallery.html">Resources</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/index.html#join-us">Community</a>
  </li>
  
  
</ul></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ProjectPythia" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/project_pythia" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCoZPBqJal5uKpO8ZiwzavCw" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Scikit-learn on Argo Observations
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preamble</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="how-to-cite.html">How to Cite This Cookbook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Argo Foundations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="argo-introduction.html">Introduction to Argo Observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="argo-access.html">Accessing Argo Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Scikit-learn Workflows on Argo</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Regression Modeling on Argo using Scikit-learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="sklearn-clustering.html">Project Pythia Notebook Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


        </div>

        
        <main id="main-content" class="bd-main" role="main">
          

            <div class="bd-content">

              <div class="bd-article-container">

                
                  
                  
<div id="searchbox"></div>
                  <article class="bd-article">
                    
  <p><img alt="Biogeochemical Argo" src="https://biogeochemical-argo.org/images/logo&#64;2x.png" /><br />
<img alt="Scikit-learn" src="https://seeklogo.com/images/S/scikit-learn-logo-8766D07E2E-seeklogo.com.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="regression-modeling-on-argo-using-scikit-learn">
<h1>Regression Modeling on Argo using Scikit-learn<a class="headerlink" href="#regression-modeling-on-argo-using-scikit-learn" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Among machine learning approaches, RFR is a relatively simple algorithm that can be trained on regional datasets too small for deep learning. RFR has been successfully applied to a range of cases in oceanography (e.g. \citet{sharp2022_GOBAIO2, callens2020_Using, tong2019_MultiFeature}), including for oxygen prediction in the Southern Ocean using BGC-Argo float data (\citet{giglio2018_Estimating}). Furthermore, many oceanographic applications highlight RFR as a useful tool for geospatial observations because of its reduced overfitting tendency and ability to handle non-linear relationships between variables \citep{zhou2023_Comparative, sharp2022_Monthly}. Deep learning methods are not necessarily better than simpler algorithms for data that are non-uniformly distributed; where multiple algorithms produce similar regional predictions, simple learners can offer greater stability and interpretability.</p>
<p>The objectives for this notebook are:</p>
<ul class="simple">
<li><p>Train RFR on data from BGC-Argo ocean autonomous profilers and GO-SHIP bottle data</p></li>
<li><p>Validate RFR to select the best model parameters, use cross-validation to assess overfitting</p></li>
<li><p>Test RFR for an estimate of prediction error</p></li>
<li><p>Predict missing variable on other profiling observations</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;../images/rfr_workflow.png&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f36038fc0cd6d4f435f196c372b783e4107d47241ad3464357abeba268b022e5.png" src="../_images/f36038fc0cd6d4f435f196c372b783e4107d47241ad3464357abeba268b022e5.png" />
</div>
</div>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>This section was inspired by <a class="reference external" href="https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md">this template</a> of the wonderful <a class="reference external" href="https://the-turing-way.netlify.app">The Turing Way</a> Jupyter Book.</p>
<p>Following your overview, tell your reader what concepts, packages, or other background information they’ll <strong>need</strong> before learning your material. Tie this explicitly with links to other pages here in Foundations or to relevant external resources. Remove this body text, then populate the Markdown table, denoted in this cell with <code class="docutils literal notranslate"><span class="pre">|</span></code> vertical brackets, below, and fill out the information following. In this table, lay out prerequisite concepts by explicitly linking to other Foundations material or external resources, or describe generally helpful concepts.</p>
<p>Label the importance of each concept explicitly as <strong>helpful/necessary</strong>.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Concepts</p></th>
<th class="head"><p>Importance</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://foundations.projectpythia.org/core/cartopy/cartopy.html">Intro to Cartopy</a></p></td>
<td><p>Necessary</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html">Understanding of NetCDF</a></p></td>
<td><p>Helpful</p></td>
<td><p>Familiarity with metadata structure</p></td>
</tr>
<tr class="row-even"><td><p>Project management</p></td>
<td><p>Helpful</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Time to learn</strong>: estimate in minutes. For a rough idea, use 5 mins per subsection, 10 if longer; add these up for a total. Safer to round up and overestimate.</p></li>
<li><p><strong>System requirements</strong>:</p>
<ul>
<li><p>Populate with any system, version, or non-Python software requirements if necessary</p></li>
<li><p>Otherwise use the concepts table above and the Imports section below to describe required packages as necessary</p></li>
<li><p>If no extra requirements, remove the <strong>System requirements</strong> point altogether</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Begin your body of content with another <code class="docutils literal notranslate"><span class="pre">---</span></code> divider before continuing into this section, then remove this body text and populate the following code cell with all necessary Python imports <strong>up-front</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib3</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="c1"># import tqdm</span>

<span class="c1"># Import argopy functions</span>
<span class="kn">import</span> <span class="nn">argopy</span>
<span class="kn">from</span> <span class="nn">argopy</span> <span class="kn">import</span> <span class="n">DataFetcher</span>  <span class="c1"># This is the class to work with Argo data</span>
<span class="kn">from</span> <span class="nn">argopy</span> <span class="kn">import</span> <span class="n">ArgoIndex</span>  <span class="c1">#  This is the class to work with Argo index</span>
<span class="kn">from</span> <span class="nn">argopy</span> <span class="kn">import</span> <span class="n">ArgoNVSReferenceTables</span>  <span class="c1"># This is the class to retrieve data from Argo reference tables</span>
<span class="kn">from</span> <span class="nn">argopy</span> <span class="kn">import</span> <span class="n">ArgoColors</span>  <span class="c1"># This is a class with usefull pre-defined colors</span>
<span class="kn">from</span> <span class="nn">argopy.plot</span> <span class="kn">import</span> <span class="n">scatter_map</span><span class="p">,</span> <span class="n">scatter_plot</span>  <span class="c1"># This is a function to easily make maps </span>
<span class="n">argopy</span><span class="o">.</span><span class="n">reset_options</span><span class="p">()</span>
<span class="n">argopy</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
<span class="n">argopy</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">cachedir</span><span class="o">=</span><span class="s1">&#39;cache_bgc&#39;</span><span class="p">)</span>
<span class="c1"># xr.set_options(display_expand_attrs = False)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;argopy.options.set_options at 0x7f9330563580&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scikit-learn packages</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kde</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">iqr</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span> <span class="k">as</span> <span class="n">score</span>

<span class="c1"># Plotting Packages</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patch</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mpcolors</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">pe</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">gsw</span>
<span class="kn">from</span> <span class="nn">cmocean</span> <span class="kn">import</span> <span class="n">cm</span> <span class="k">as</span> <span class="n">cmo</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-background-random-forest-regression">
<h2>Optional Background: Random Forest Regression<a class="headerlink" href="#optional-background-random-forest-regression" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Random Forest (RF) regression is a supervised machine learning method that averages the results over a “forest” of <span class="math notranslate nohighlight">\(n\)</span> decision trees for final prediction. Each decision tree determines a series of conditions at each node based on a set of observed variables, referred to as features. For regression, the trees find conditions that best separate the target observations into branches with the least variance.</p>
<p>Formally, observations are sorted into <span class="math notranslate nohighlight">\(j\)</span> regions of predictor space (<span class="math notranslate nohighlight">\(R_j\)</span>) during training. Following the notation in James et al. (2013), each node in the tree considers a split into two new regions based on a condition <span class="math notranslate nohighlight">\(s\)</span> for a predictor <span class="math notranslate nohighlight">\(X_j\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9056b27c-8f11-44c5-bbd0-03e4feb9b95f">
<span class="eqno">(2)<a class="headerlink" href="#equation-9056b27c-8f11-44c5-bbd0-03e4feb9b95f" title="Permalink to this equation"><i class="fas fa-link"></i></a></span>\[\begin{equation}
\begin{split}
R_1(j,s) = \{X|X_j &lt; s\} \text{ and } R_2(j,s) = \{X|X_j \ge s\}, \\
\end{split}
\end{equation}\]</div>
<p>and each region is assigned a prediction value that is the average of all target variable values (<span class="math notranslate nohighlight">\(\hat{y}_{R_j}\)</span> ) within <span class="math notranslate nohighlight">\(R_j\)</span>. The condition <span class="math notranslate nohighlight">\(s\)</span> is chosen to minimize the residual sum of squares in the resulting bins:</p>
<div class="amsmath math notranslate nohighlight" id="equation-160cf691-2b76-417a-b170-c5a009a141a2">
<span class="eqno">(3)<a class="headerlink" href="#equation-160cf691-2b76-417a-b170-c5a009a141a2" title="Permalink to this equation"><i class="fas fa-link"></i></a></span>\[\begin{equation}
\begin{split}
\sum_{i: \: x_i \in \: R_1(j,s)}{} (y_i-\hat{y}_{R_1})^2 \; + \sum_{i: \: x_i \in \: R_2(j,s)}{} (y_i-\hat{y}_{R_2})^2,
\end{split}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_i\)</span> represents each observed value. During testing, validation, and prediction, RF sorts input observations into the regions and assigns them the value <span class="math notranslate nohighlight">\(\hat{y}_{R_j}\)</span>. One advantage of RF is that it limits the decision at each node split to a random subset of features. As a result, the trees in Random Forest are less correlated than those in a family of ``bagged’’ trees which consider all possible features at all nodes. The RF method is therefore less prone to overfitting, especially on spatiotemporally biased data (Stock et.al (2022), Sharp et al. 2022).</p>
</section>
<section id="determine-spatial-and-temporal-bounds-of-argo-data">
<h2>Determine spatial and temporal bounds of Argo data<a class="headerlink" href="#determine-spatial-and-temporal-bounds-of-argo-data" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>We will use Argopy to set up some data to run RFR.
As an example, we access 3 years of North Atlantic data in 2019 through 2022.
We adapt this code from the example Argopy notebook are documented <a class="reference external" href="https://nbviewer.org/github/euroargodev/argopy/blob/master/docs/examples/BGC_region_float_data.ipynb">here</a>.</p>
<p>Our approach downloads synthetic profiles, which are described in the previous notebook, <a class="reference internal" href="argo-access.html"><span class="std std-doc">Accessing Argo</span></a> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In the format [minlon, maxlon, minlat, maxlat, mindepth, maxdepth, start_date, end_date]</span>
<span class="n">BOX</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">56</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;2019-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01&#39;</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">ArgoIndex</span><span class="p">(</span><span class="n">index_file</span><span class="o">=</span><span class="s1">&#39;bgc-s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>  <span class="c1"># Synthetic profiles</span>
<span class="n">idx</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;argoindex.pandas&gt;
Host: https://data-argo.ifremer.fr
Index: argo_synthetic-profile_index.txt
Convention: argo_synthetic-profile_index (Synthetic-Profile directory file of the Argo GDAC)
Loaded: True (314361 records)
Searched: False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select profile in a space/time domain:</span>
<span class="n">index_BOX</span> <span class="o">=</span> <span class="p">[</span><span class="n">BOX</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>  <span class="c1"># We don&#39;t want the pressure axis BOX limits</span>
<span class="n">idx</span><span class="o">.</span><span class="n">search_lat_lon_tim</span><span class="p">(</span><span class="n">index_BOX</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;argoindex.pandas&gt;
Host: https://data-argo.ifremer.fr
Index: argo_synthetic-profile_index.txt
Convention: argo_synthetic-profile_index (Synthetic-Profile directory file of the Argo GDAC)
Loaded: True (314361 records)
Searched: True (1464 matches, 0.4657%)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the list of all parameters for this region:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parameters measured in the region: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">read_params</span><span class="p">()));</span> <span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;There are &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">read_wmo</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39; floats in the region.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameters measured in the region: 
[&#39;BBP700&#39;, &#39;CDOM&#39;, &#39;CHLA&#39;, &#39;CHLA_FLUORESCENCE&#39;, &#39;CP660&#39;, &#39;DOWNWELLING_PAR&#39;, &#39;DOWN_IRRADIANCE380&#39;, &#39;DOWN_IRRADIANCE412&#39;, &#39;DOWN_IRRADIANCE490&#39;, &#39;DOXY&#39;, &#39;NITRATE&#39;, &#39;PH_IN_SITU_TOTAL&#39;, &#39;PRES&#39;, &#39;PSAL&#39;, &#39;TEMP&#39;]

There are 51 floats in the region.
</pre></div>
</div>
</div>
</div>
</section>
<section id="fetching-data-using-argopy">
<h2>Fetching data using Argopy<a class="headerlink" href="#fetching-data-using-argopy" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The following code fetches the actual data from the <code class="docutils literal notranslate"><span class="pre">BOX</span></code> bounds we used earlier. If using the parameters given here, the process takes about 6 minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">DataFetcher</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="s1">&#39;bgc&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;expert&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">chunks_maxsize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
               <span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">BOX</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='parent'>
<style>/* W3.CSS 4.15 December 2020 by Jan Egil and Borge Refsnes */
html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
article,aside,details,figcaption,figure,footer,header,main,menu,nav,section{display:block}summary{display:list-item}
audio,canvas,progress,video{display:inline-block}progress{vertical-align:baseline}
audio:not([controls]){display:none;height:0}[hidden],template{display:none}
a{background-color:transparent}a:active,a:hover{outline-width:0}
abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}
b,strong{font-weight:bolder}dfn{font-style:italic}mark{background:#ff0;color:#000}
small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sub{bottom:-0.25em}sup{top:-0.5em}figure{margin:1em 40px}img{border-style:none}
code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}hr{box-sizing:content-box;height:0;overflow:visible}
button,input,select,textarea,optgroup{font:inherit;margin:0}optgroup{font-weight:bold}
button,input{overflow:visible}button,select{text-transform:none}
button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}
button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}
button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}
fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}
legend{color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}
[type=checkbox],[type=radio]{padding:0}
[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}
[type=search]{-webkit-appearance:textfield;outline-offset:-2px}
[type=search]::-webkit-search-decoration{-webkit-appearance:none}
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
/* End extract */
html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}
h1{font-size:36px}h2{font-size:30px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}
.w3-serif{font-family:serif}.w3-sans-serif{font-family:sans-serif}.w3-cursive{font-family:cursive}.w3-monospace{font-family:monospace}
h1,h2,h3,h4,h5,h6{font-family:"Segoe UI",Arial,sans-serif;font-weight:400;margin:10px 0}.w3-wide{letter-spacing:4px}
hr{border:0;border-top:1px solid #eee;margin:20px 0}
.w3-image{max-width:100%;height:auto}img{vertical-align:middle}a{color:inherit}
.w3-table,.w3-table-all{border-collapse:collapse;border-spacing:0;width:100%;display:table}.w3-table-all{border:1px solid #ccc}
.w3-bordered tr,.w3-table-all tr{border-bottom:1px solid #ddd}.w3-striped tbody tr:nth-child(even){background-color:#f1f1f1}
.w3-table-all tr:nth-child(odd){background-color:#fff}.w3-table-all tr:nth-child(even){background-color:#f1f1f1}
.w3-hoverable tbody tr:hover,.w3-ul.w3-hoverable li:hover{background-color:#ccc}.w3-centered tr th,.w3-centered tr td{text-align:center}
.w3-table td,.w3-table th,.w3-table-all td,.w3-table-all th{padding:8px 8px;display:table-cell;text-align:left;vertical-align:top}
.w3-table th:first-child,.w3-table td:first-child,.w3-table-all th:first-child,.w3-table-all td:first-child{padding-left:16px}
.w3-btn,.w3-button{border:none;display:inline-block;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}
.w3-btn:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}
.w3-btn,.w3-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.w3-disabled,.w3-btn:disabled,.w3-button:disabled{cursor:not-allowed;opacity:0.3}.w3-disabled *,:disabled *{pointer-events:none}
.w3-btn.w3-disabled:hover,.w3-btn:disabled:hover{box-shadow:none}
.w3-badge,.w3-tag{background-color:#000;color:#fff;display:inline-block;padding-left:8px;padding-right:8px;text-align:center}.w3-badge{border-radius:50%}
.w3-ul{list-style-type:none;padding:0;margin:0}.w3-ul li{padding:8px 16px;border-bottom:1px solid #ddd}.w3-ul li:last-child{border-bottom:none}
.w3-tooltip,.w3-display-container{position:relative}.w3-tooltip .w3-text{display:none}.w3-tooltip:hover .w3-text{display:inline-block}
.w3-ripple:active{opacity:0.5}.w3-ripple{transition:opacity 0s}
.w3-input{padding:8px;display:block;border:none;border-bottom:1px solid #ccc;width:100%}
.w3-select{padding:9px 0;width:100%;border:none;border-bottom:1px solid #ccc}
.w3-dropdown-click,.w3-dropdown-hover{position:relative;display:inline-block;cursor:pointer}
.w3-dropdown-hover:hover .w3-dropdown-content{display:block}
.w3-dropdown-hover:first-child,.w3-dropdown-click:hover{background-color:#ccc;color:#000}
.w3-dropdown-hover:hover > .w3-button:first-child,.w3-dropdown-click:hover > .w3-button:first-child{background-color:#ccc;color:#000}
.w3-dropdown-content{cursor:auto;color:#000;background-color:#fff;display:none;position:absolute;min-width:160px;margin:0;padding:0;z-index:1}
.w3-check,.w3-radio{width:24px;height:24px;position:relative;top:6px}
.w3-sidebar{height:100%;width:200px;background-color:#fff;position:fixed!important;z-index:1;overflow:auto}
.w3-bar-block .w3-dropdown-hover,.w3-bar-block .w3-dropdown-click{width:100%}
.w3-bar-block .w3-dropdown-hover .w3-dropdown-content,.w3-bar-block .w3-dropdown-click .w3-dropdown-content{min-width:100%}
.w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}
.w3-main,#main{transition:margin-left .4s}
.w3-modal{z-index:3;display:none;padding-top:100px;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgb(0,0,0);background-color:rgba(0,0,0,0.4)}
.w3-modal-content{margin:auto;background-color:#fff;position:relative;padding:0;outline:0;width:600px}
.w3-bar{width:100%;overflow:hidden}.w3-center .w3-bar{display:inline-block;width:auto}
.w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:none;display:block;outline:0}
.w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}
.w3-bar .w3-button{white-space:normal}
.w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:none;white-space:normal;float:none;outline:0}
.w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}
.w3-responsive{display:block;overflow-x:auto}
.w3-container:after,.w3-container:before,.w3-panel:after,.w3-panel:before,.w3-row:after,.w3-row:before,.w3-row-padding:after,.w3-row-padding:before,
.w3-cell-row:before,.w3-cell-row:after,.w3-clear:after,.w3-clear:before,.w3-bar:before,.w3-bar:after{content:"";display:table;clear:both}
.w3-col,.w3-half,.w3-third,.w3-twothird,.w3-threequarter,.w3-quarter{float:left;width:100%}
.w3-col.s1{width:8.33333%}.w3-col.s2{width:16.66666%}.w3-col.s3{width:24.99999%}.w3-col.s4{width:33.33333%}
.w3-col.s5{width:41.66666%}.w3-col.s6{width:49.99999%}.w3-col.s7{width:58.33333%}.w3-col.s8{width:66.66666%}
.w3-col.s9{width:74.99999%}.w3-col.s10{width:83.33333%}.w3-col.s11{width:91.66666%}.w3-col.s12{width:99.99999%}
@media (min-width:601px){.w3-col.m1{width:8.33333%}.w3-col.m2{width:16.66666%}.w3-col.m3,.w3-quarter{width:24.99999%}.w3-col.m4,.w3-third{width:33.33333%}
.w3-col.m5{width:41.66666%}.w3-col.m6,.w3-half{width:49.99999%}.w3-col.m7{width:58.33333%}.w3-col.m8,.w3-twothird{width:66.66666%}
.w3-col.m9,.w3-threequarter{width:74.99999%}.w3-col.m10{width:83.33333%}.w3-col.m11{width:91.66666%}.w3-col.m12{width:99.99999%}}
@media (min-width:993px){.w3-col.l1{width:8.33333%}.w3-col.l2{width:16.66666%}.w3-col.l3{width:24.99999%}.w3-col.l4{width:33.33333%}
.w3-col.l5{width:41.66666%}.w3-col.l6{width:49.99999%}.w3-col.l7{width:58.33333%}.w3-col.l8{width:66.66666%}
.w3-col.l9{width:74.99999%}.w3-col.l10{width:83.33333%}.w3-col.l11{width:91.66666%}.w3-col.l12{width:99.99999%}}
.w3-rest{overflow:hidden}.w3-stretch{margin-left:-16px;margin-right:-16px}
.w3-content,.w3-auto{margin-left:auto;margin-right:auto}.w3-content{max-width:980px}.w3-auto{max-width:1140px}
.w3-cell-row{display:table;width:100%}.w3-cell{display:table-cell}
.w3-cell-top{vertical-align:top}.w3-cell-middle{vertical-align:middle}.w3-cell-bottom{vertical-align:bottom}
.w3-hide{display:none!important}.w3-show-block,.w3-show{display:block!important}.w3-show-inline-block{display:inline-block!important}
@media (max-width:1205px){.w3-auto{max-width:95%}}
@media (max-width:600px){.w3-modal-content{margin:0 10px;width:auto!important}.w3-modal{padding-top:30px}
.w3-dropdown-hover.w3-mobile .w3-dropdown-content,.w3-dropdown-click.w3-mobile .w3-dropdown-content{position:relative}
.w3-hide-small{display:none!important}.w3-mobile{display:block;width:100%!important}.w3-bar-item.w3-mobile,.w3-dropdown-hover.w3-mobile,.w3-dropdown-click.w3-mobile{text-align:center}
.w3-dropdown-hover.w3-mobile,.w3-dropdown-hover.w3-mobile .w3-btn,.w3-dropdown-hover.w3-mobile .w3-button,.w3-dropdown-click.w3-mobile,.w3-dropdown-click.w3-mobile .w3-btn,.w3-dropdown-click.w3-mobile .w3-button{width:100%}}
@media (max-width:768px){.w3-modal-content{width:500px}.w3-modal{padding-top:50px}}
@media (min-width:993px){.w3-modal-content{width:900px}.w3-hide-large{display:none!important}.w3-sidebar.w3-collapse{display:block!important}}
@media (max-width:992px) and (min-width:601px){.w3-hide-medium{display:none!important}}
@media (max-width:992px){.w3-sidebar.w3-collapse{display:none}.w3-main{margin-left:0!important;margin-right:0!important}.w3-auto{max-width:100%}}
.w3-top,.w3-bottom{position:fixed;width:100%;z-index:1}.w3-top{top:0}.w3-bottom{bottom:0}
.w3-overlay{position:fixed;display:none;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:2}
.w3-display-topleft{position:absolute;left:0;top:0}.w3-display-topright{position:absolute;right:0;top:0}
.w3-display-bottomleft{position:absolute;left:0;bottom:0}.w3-display-bottomright{position:absolute;right:0;bottom:0}
.w3-display-middle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%)}
.w3-display-left{position:absolute;top:50%;left:0%;transform:translate(0%,-50%);-ms-transform:translate(-0%,-50%)}
.w3-display-right{position:absolute;top:50%;right:0%;transform:translate(0%,-50%);-ms-transform:translate(0%,-50%)}
.w3-display-topmiddle{position:absolute;left:50%;top:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}
.w3-display-bottommiddle{position:absolute;left:50%;bottom:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}
.w3-display-container:hover .w3-display-hover{display:block}.w3-display-container:hover span.w3-display-hover{display:inline-block}.w3-display-hover{display:none}
.w3-display-position{position:absolute}
.w3-circle{border-radius:50%}
.w3-round-small{border-radius:2px}.w3-round,.w3-round-medium{border-radius:4px}.w3-round-large{border-radius:8px}.w3-round-xlarge{border-radius:16px}.w3-round-xxlarge{border-radius:32px}
.w3-row-padding,.w3-row-padding>.w3-half,.w3-row-padding>.w3-third,.w3-row-padding>.w3-twothird,.w3-row-padding>.w3-threequarter,.w3-row-padding>.w3-quarter,.w3-row-padding>.w3-col{padding:0 8px}
.w3-container,.w3-panel{padding:0.01em 16px}.w3-panel{margin-top:16px;margin-bottom:16px}
.w3-code,.w3-codespan{font-family:Consolas,"courier new";font-size:16px}
.w3-code{width:auto;background-color:#fff;padding:8px 12px;border-left:4px solid #4CAF50;word-wrap:break-word}
.w3-codespan{color:crimson;background-color:#f1f1f1;padding-left:4px;padding-right:4px;font-size:110%}
.w3-card,.w3-card-2{box-shadow:0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)}
.w3-card-4,.w3-hover-shadow:hover{box-shadow:0 4px 10px 0 rgba(0,0,0,0.2),0 4px 20px 0 rgba(0,0,0,0.19)}
.w3-spin{animation:w3-spin 2s infinite linear}@keyframes w3-spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}
.w3-animate-fading{animation:fading 10s infinite}@keyframes fading{0%{opacity:0}50%{opacity:1}100%{opacity:0}}
.w3-animate-opacity{animation:opac 0.8s}@keyframes opac{from{opacity:0} to{opacity:1}}
.w3-animate-top{position:relative;animation:animatetop 0.4s}@keyframes animatetop{from{top:-300px;opacity:0} to{top:0;opacity:1}}
.w3-animate-left{position:relative;animation:animateleft 0.4s}@keyframes animateleft{from{left:-300px;opacity:0} to{left:0;opacity:1}}
.w3-animate-right{position:relative;animation:animateright 0.4s}@keyframes animateright{from{right:-300px;opacity:0} to{right:0;opacity:1}}
.w3-animate-bottom{position:relative;animation:animatebottom 0.4s}@keyframes animatebottom{from{bottom:-300px;opacity:0} to{bottom:0;opacity:1}}
.w3-animate-zoom {animation:animatezoom 0.6s}@keyframes animatezoom{from{transform:scale(0)} to{transform:scale(1)}}
.w3-animate-input{transition:width 0.4s ease-in-out}.w3-animate-input:focus{width:100%!important}
.w3-opacity,.w3-hover-opacity:hover{opacity:0.60}.w3-opacity-off,.w3-hover-opacity-off:hover{opacity:1}
.w3-opacity-max{opacity:0.25}.w3-opacity-min{opacity:0.75}
.w3-greyscale-max,.w3-grayscale-max,.w3-hover-greyscale:hover,.w3-hover-grayscale:hover{filter:grayscale(100%)}
.w3-greyscale,.w3-grayscale{filter:grayscale(75%)}.w3-greyscale-min,.w3-grayscale-min{filter:grayscale(50%)}
.w3-sepia{filter:sepia(75%)}.w3-sepia-max,.w3-hover-sepia:hover{filter:sepia(100%)}.w3-sepia-min{filter:sepia(50%)}
.w3-tiny{font-size:10px!important}.w3-small{font-size:12px!important}.w3-medium{font-size:15px!important}.w3-large{font-size:18px!important}
.w3-xlarge{font-size:24px!important}.w3-xxlarge{font-size:36px!important}.w3-xxxlarge{font-size:48px!important}.w3-jumbo{font-size:64px!important}
.w3-left-align{text-align:left!important}.w3-right-align{text-align:right!important}.w3-justify{text-align:justify!important}.w3-center{text-align:center!important}
.w3-border-0{border:0!important}.w3-border{border:1px solid #ccc!important}
.w3-border-top{border-top:1px solid #ccc!important}.w3-border-bottom{border-bottom:1px solid #ccc!important}
.w3-border-left{border-left:1px solid #ccc!important}.w3-border-right{border-right:1px solid #ccc!important}
.w3-topbar{border-top:6px solid #ccc!important}.w3-bottombar{border-bottom:6px solid #ccc!important}
.w3-leftbar{border-left:6px solid #ccc!important}.w3-rightbar{border-right:6px solid #ccc!important}
.w3-section,.w3-code{margin-top:16px!important;margin-bottom:16px!important}
.w3-margin{margin:16px!important}.w3-margin-top{margin-top:16px!important}.w3-margin-bottom{margin-bottom:16px!important}
.w3-margin-left{margin-left:16px!important}.w3-margin-right{margin-right:16px!important}
.w3-padding-small{padding:4px 8px!important}.w3-padding{padding:8px 16px!important}.w3-padding-large{padding:12px 24px!important}
.w3-padding-16{padding-top:16px!important;padding-bottom:16px!important}.w3-padding-24{padding-top:24px!important;padding-bottom:24px!important}
.w3-padding-32{padding-top:32px!important;padding-bottom:32px!important}.w3-padding-48{padding-top:48px!important;padding-bottom:48px!important}
.w3-padding-64{padding-top:64px!important;padding-bottom:64px!important}
.w3-padding-top-64{padding-top:64px!important}.w3-padding-top-48{padding-top:48px!important}
.w3-padding-top-32{padding-top:32px!important}.w3-padding-top-24{padding-top:24px!important}
.w3-left{float:left!important}.w3-right{float:right!important}
.w3-button:hover{color:#000!important;background-color:#ccc!important}
.w3-transparent,.w3-hover-none:hover{background-color:transparent!important}
.w3-hover-none:hover{box-shadow:none!important}
/* Colors */
.w3-amber,.w3-hover-amber:hover{color:#000!important;background-color:#ffc107!important}
.w3-aqua,.w3-hover-aqua:hover{color:#000!important;background-color:#00ffff!important}
.w3-blue,.w3-hover-blue:hover{color:#fff!important;background-color:#2196F3!important}
.w3-light-blue,.w3-hover-light-blue:hover{color:#000!important;background-color:#87CEEB!important}
.w3-brown,.w3-hover-brown:hover{color:#fff!important;background-color:#795548!important}
.w3-cyan,.w3-hover-cyan:hover{color:#000!important;background-color:#00bcd4!important}
.w3-blue-grey,.w3-hover-blue-grey:hover,.w3-blue-gray,.w3-hover-blue-gray:hover{color:#fff!important;background-color:#607d8b!important}
.w3-green,.w3-hover-green:hover{color:#fff!important;background-color:#4CAF50!important}
.w3-light-green,.w3-hover-light-green:hover{color:#000!important;background-color:#8bc34a!important}
.w3-indigo,.w3-hover-indigo:hover{color:#fff!important;background-color:#3f51b5!important}
.w3-khaki,.w3-hover-khaki:hover{color:#000!important;background-color:#f0e68c!important}
.w3-lime,.w3-hover-lime:hover{color:#000!important;background-color:#cddc39!important}
.w3-orange,.w3-hover-orange:hover{color:#000!important;background-color:#ff9800!important}
.w3-deep-orange,.w3-hover-deep-orange:hover{color:#fff!important;background-color:#ff5722!important}
.w3-pink,.w3-hover-pink:hover{color:#fff!important;background-color:#e91e63!important}
.w3-purple,.w3-hover-purple:hover{color:#fff!important;background-color:#9c27b0!important}
.w3-deep-purple,.w3-hover-deep-purple:hover{color:#fff!important;background-color:#673ab7!important}
.w3-red,.w3-hover-red:hover{color:#fff!important;background-color:#f44336!important}
.w3-sand,.w3-hover-sand:hover{color:#000!important;background-color:#fdf5e6!important}
.w3-teal,.w3-hover-teal:hover{color:#fff!important;background-color:#009688!important}
.w3-yellow,.w3-hover-yellow:hover{color:#000!important;background-color:#ffeb3b!important}
.w3-white,.w3-hover-white:hover{color:#000!important;background-color:#fff!important}
.w3-black,.w3-hover-black:hover{color:#fff!important;background-color:#000!important}
.w3-grey,.w3-hover-grey:hover,.w3-gray,.w3-hover-gray:hover{color:#000!important;background-color:#9e9e9e!important}
.w3-light-grey,.w3-hover-light-grey:hover,.w3-light-gray,.w3-hover-light-gray:hover{color:#000!important;background-color:#f1f1f1!important}
.w3-dark-grey,.w3-hover-dark-grey:hover,.w3-dark-gray,.w3-hover-dark-gray:hover{color:#fff!important;background-color:#616161!important}
.w3-pale-red,.w3-hover-pale-red:hover{color:#000!important;background-color:#ffdddd!important}
.w3-pale-green,.w3-hover-pale-green:hover{color:#000!important;background-color:#ddffdd!important}
.w3-pale-yellow,.w3-hover-pale-yellow:hover{color:#000!important;background-color:#ffffcc!important}
.w3-pale-blue,.w3-hover-pale-blue:hover{color:#000!important;background-color:#ddffff!important}
.w3-text-amber,.w3-hover-text-amber:hover{color:#ffc107!important}
.w3-text-aqua,.w3-hover-text-aqua:hover{color:#00ffff!important}
.w3-text-blue,.w3-hover-text-blue:hover{color:#2196F3!important}
.w3-text-light-blue,.w3-hover-text-light-blue:hover{color:#87CEEB!important}
.w3-text-brown,.w3-hover-text-brown:hover{color:#795548!important}
.w3-text-cyan,.w3-hover-text-cyan:hover{color:#00bcd4!important}
.w3-text-blue-grey,.w3-hover-text-blue-grey:hover,.w3-text-blue-gray,.w3-hover-text-blue-gray:hover{color:#607d8b!important}
.w3-text-green,.w3-hover-text-green:hover{color:#4CAF50!important}
.w3-text-light-green,.w3-hover-text-light-green:hover{color:#8bc34a!important}
.w3-text-indigo,.w3-hover-text-indigo:hover{color:#3f51b5!important}
.w3-text-khaki,.w3-hover-text-khaki:hover{color:#b4aa50!important}
.w3-text-lime,.w3-hover-text-lime:hover{color:#cddc39!important}
.w3-text-orange,.w3-hover-text-orange:hover{color:#ff9800!important}
.w3-text-deep-orange,.w3-hover-text-deep-orange:hover{color:#ff5722!important}
.w3-text-pink,.w3-hover-text-pink:hover{color:#e91e63!important}
.w3-text-purple,.w3-hover-text-purple:hover{color:#9c27b0!important}
.w3-text-deep-purple,.w3-hover-text-deep-purple:hover{color:#673ab7!important}
.w3-text-red,.w3-hover-text-red:hover{color:#f44336!important}
.w3-text-sand,.w3-hover-text-sand:hover{color:#fdf5e6!important}
.w3-text-teal,.w3-hover-text-teal:hover{color:#009688!important}
.w3-text-yellow,.w3-hover-text-yellow:hover{color:#d2be0e!important}
.w3-text-white,.w3-hover-text-white:hover{color:#fff!important}
.w3-text-black,.w3-hover-text-black:hover{color:#000!important}
.w3-text-grey,.w3-hover-text-grey:hover,.w3-text-gray,.w3-hover-text-gray:hover{color:#757575!important}
.w3-text-light-grey,.w3-hover-text-light-grey:hover,.w3-text-light-gray,.w3-hover-text-light-gray:hover{color:#f1f1f1!important}
.w3-text-dark-grey,.w3-hover-text-dark-grey:hover,.w3-text-dark-gray,.w3-hover-text-dark-gray:hover{color:#3a3a3a!important}
.w3-border-amber,.w3-hover-border-amber:hover{border-color:#ffc107!important}
.w3-border-aqua,.w3-hover-border-aqua:hover{border-color:#00ffff!important}
.w3-border-blue,.w3-hover-border-blue:hover{border-color:#2196F3!important}
.w3-border-light-blue,.w3-hover-border-light-blue:hover{border-color:#87CEEB!important}
.w3-border-brown,.w3-hover-border-brown:hover{border-color:#795548!important}
.w3-border-cyan,.w3-hover-border-cyan:hover{border-color:#00bcd4!important}
.w3-border-blue-grey,.w3-hover-border-blue-grey:hover,.w3-border-blue-gray,.w3-hover-border-blue-gray:hover{border-color:#607d8b!important}
.w3-border-green,.w3-hover-border-green:hover{border-color:#4CAF50!important}
.w3-border-light-green,.w3-hover-border-light-green:hover{border-color:#8bc34a!important}
.w3-border-indigo,.w3-hover-border-indigo:hover{border-color:#3f51b5!important}
.w3-border-khaki,.w3-hover-border-khaki:hover{border-color:#f0e68c!important}
.w3-border-lime,.w3-hover-border-lime:hover{border-color:#cddc39!important}
.w3-border-orange,.w3-hover-border-orange:hover{border-color:#ff9800!important}
.w3-border-deep-orange,.w3-hover-border-deep-orange:hover{border-color:#ff5722!important}
.w3-border-pink,.w3-hover-border-pink:hover{border-color:#e91e63!important}
.w3-border-purple,.w3-hover-border-purple:hover{border-color:#9c27b0!important}
.w3-border-deep-purple,.w3-hover-border-deep-purple:hover{border-color:#673ab7!important}
.w3-border-red,.w3-hover-border-red:hover{border-color:#f44336!important}
.w3-border-sand,.w3-hover-border-sand:hover{border-color:#fdf5e6!important}
.w3-border-teal,.w3-hover-border-teal:hover{border-color:#009688!important}
.w3-border-yellow,.w3-hover-border-yellow:hover{border-color:#ffeb3b!important}
.w3-border-white,.w3-hover-border-white:hover{border-color:#fff!important}
.w3-border-black,.w3-hover-border-black:hover{border-color:#000!important}
.w3-border-grey,.w3-hover-border-grey:hover,.w3-border-gray,.w3-hover-border-gray:hover{border-color:#9e9e9e!important}
.w3-border-light-grey,.w3-hover-border-light-grey:hover,.w3-border-light-gray,.w3-hover-border-light-gray:hover{border-color:#f1f1f1!important}
.w3-border-dark-grey,.w3-hover-border-dark-grey:hover,.w3-border-dark-gray,.w3-hover-border-dark-gray:hover{border-color:#616161!important}
.w3-border-pale-red,.w3-hover-border-pale-red:hover{border-color:#ffe7e7!important}.w3-border-pale-green,.w3-hover-border-pale-green:hover{border-color:#e7ffe7!important}
.w3-border-pale-yellow,.w3-hover-border-pale-yellow:hover{border-color:#ffffcc!important}.w3-border-pale-blue,.w3-hover-border-pale-blue:hover{border-color:#e7ffff!important}
/* CSS stylesheet for displaying MultiThreading computation tasks status in jupyterlab
 *
 */

.cyan {
  background-color: #12eae4ff;
}
.blue {
  background-color: #1088b5ff;
}
.darkblue {
  background-color: rgba(10, 89, 161, 1);
}
.yellow {
  background-color: #e4ad29ff;
}
.darkyellow {
  background-color: #df9d25ff;
}

.red {
    background-color: rgba(240, 18, 18, 0.75);
}
.green {
  background-color: #32cd32;
}
.orange {
  background-color: orange;
}
.black {
  background-color: black;
}
.gray {
  background-color: rgba(211, 211, 211, 1);
}

.box {
  float: left;
  height: 12px;
  width: 12px;
  margin-bottom: 5px;
  border: 1px solid white;
  display:inline-block;
}
.parent {
    text-align:left;
    border: 0px dashed #1c87c9;
	display:table;
    background-color: #FFF;
}
.legend {
	text-align:left;
	vertical-align: middle;
	margin-bottom: 5px;
	height:15px;
	line-height:15px;
}
.legend .item {
	display:inline-block;
}
.legend .box {
  height: 12px;
  width: 12px;
  margin-left: 5px;
}
.legend .txt {
  color: #000;
  vertical-align: middle;
  display: inline-block;
  margin-left: 5px;
}
.status {
	text-align:left;
	vertical-align: middle;
	margin-bottom: 5px;
	margin-left: 0px;
	border: 2px solid rgba(211, 211, 211, 1);
	padding: 5px;
	display: table;
}

.blinking {
	border: 2px solid #e4ad29ff;
	animation-name: blinking;
	animation-duration: 1s;
	animation-iteration-count: 100;
}
@keyframes blinking {
  50% {
    border-color: #FFF;
  }
}
.none {
	border: 0px;
}
.queue {
	border: 2px solid rgba(211, 211, 211, 1);
}
.success {
	border: 2px solid #32cd32;
}
.failure {
	border: 2px solid #f01212;
}</style>
	<div class='legend'>
		<div class='item'><div class='box gray'></div><span class='txt'>Queued</span></div>
		<div class='item'><div class='box yellow'></div><span class='txt'>Downloading netcdf from the erddap</span></div>
		<div class='item'><div class='box blue'></div><span class='txt'>Formatting xarray dataset</span></div>
		<div class='item'><div class='box cyan'></div><span class='txt'>Callback</span></div>
		<div class='item'><div class='box red'></div><span class='txt'>Failed or No Data</span></div>
		<div class='item'><div class='box green'></div><span class='txt'>Success</span></div>
	</div>
	<div class='status success'>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box red'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
		<div class='box green'></div>
	</div>
</div>
	<div class='w3-light-grey w3-small w3-round'>
		<div class='w3-container w3-round w3-green' style='width:100%'>Succeed in Merging chunks of xarray dataset (100% processed)</div>
	</div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final post-processing of the merged dataset () ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/sklearn-argo-dev/lib/python3.9/site-packages/argopy/xarray.py:70: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.
  self._dims = list(xarray_obj.dims.keys())
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;datafetcher.erddap&gt;
Name: Ifremer erddap Argo BGC data fetcher for a space/time region
API: https://erddap.ifremer.fr/erddap
Domain: [x=-56.00/-45.00; y=54.00/60.0 ... 00.0; t=2019-01-01/2023-01-01]
BGC variables: [&#39;BBP700&#39;, &#39;CDOM&#39;, &#39;CHLA&#39;, &#39;CP660&#39;, &#39;DOWNWELLING_PAR&#39;, &#39;DOWN_IRRADIANCE380&#39;, &#39;DOWN_IRRADIANCE412&#39;, &#39;DOWN_IRRADIANCE490&#39;, &#39;DOXY&#39;, &#39;NITRATE&#39;, &#39;PH_IN_SITU_TOTAL&#39;, &#39;PRES&#39;, &#39;PSAL&#39;, &#39;TEMP&#39;]
BGC &#39;must be measured&#39; variables: []
Performances: cache=False, parallel=True
User mode: expert
Dataset: bgc
</pre></div>
</div>
</div>
</div>
<p>Again, the data is retrieved as an xarray Dataset. Metadata can be returned using the object <code class="docutils literal notranslate"><span class="pre">index</span></code> in a DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the data structure (xarray.dataset):</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">data</span> <span class="c1"># Dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span> <span class="c1"># Dataframe index</span>
</pre></div>
</div>
</div>
</div>
<p>We can visualize where our training profiles are using a function included in Argopy.
By setting the parameter <code class="docutils literal notranslate"><span class="pre">set_global=True</span></code>, we can see the profiles in a global map context.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">traj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">set_global</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Float Profile Locations (by WMO)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/503dce534e766fb142faa5bf6eb231b63380677b6c845fe6efc6576ab98062f8.png" src="../_images/503dce534e766fb142faa5bf6eb231b63380677b6c845fe6efc6576ab98062f8.png" />
</div>
</div>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_param</span> <span class="o">=</span> <span class="s1">&#39;PSAL&#39;</span>
<span class="n">reftbl</span> <span class="o">=</span> <span class="n">ArgoNVSReferenceTables</span><span class="p">()</span><span class="o">.</span><span class="n">tbl</span><span class="p">(</span><span class="s1">&#39;R03&#39;</span><span class="p">)</span>
<span class="n">param_info</span> <span class="o">=</span> <span class="n">reftbl</span><span class="p">[</span><span class="n">reftbl</span><span class="p">[</span><span class="s1">&#39;altLabel&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">a_param</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">param_info</span>

<span class="c1"># To make the scatter map, we need to have the data mode available in one DataFrame column</span>
<span class="c1"># so we need to add a new column with the DATA_MODE of the PARAMETER:</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_DM&quot;</span> <span class="o">%</span> <span class="n">a_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;parameter_data_mode&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_param</span><span class="p">)]</span> <span class="k">if</span> <span class="n">a_param</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Finally plot the map:</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">scatter_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_DM&quot;</span> <span class="o">%</span> <span class="n">a_param</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;data_mode&quot;</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                        <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                        <span class="n">traj_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                        <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;Data mode&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Data mode for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="si">%i</span><span class="s2"> profiles from the </span><span class="si">%s</span><span class="se">\n</span><span class="si">%i</span><span class="s2"> profiles downloaded&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;prefLabel&#39;</span><span class="p">],</span> <span class="n">a_param</span><span class="p">,</span> 
                                                                           <span class="n">idx</span><span class="o">.</span><span class="n">N_MATCH</span><span class="p">,</span> <span class="n">idx</span><span class="o">.</span><span class="n">convention_title</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7ad23040fc881802a6805a578a9ac8b0287b3d99c5dc613c14c422500f18f2b3.png" src="../_images/7ad23040fc881802a6805a578a9ac8b0287b3d99c5dc613c14c422500f18f2b3.png" />
</div>
</div>
<section id="choose-example-parameter-to-visualize">
<h3>Choose example parameter to visualize<a class="headerlink" href="#choose-example-parameter-to-visualize" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>We can plot the adjusted Salinity over pressure, and color by QC flag.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">scatter_plot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">a_param</span> <span class="o">+</span> <span class="s1">&#39;_ADJUSTED_QC&#39;</span><span class="p">,</span> <span class="n">this_x</span> <span class="o">=</span> <span class="n">a_param</span> <span class="o">+</span> <span class="s1">&#39;_ADJUSTED&#39;</span><span class="p">,</span> 
                       <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">ArgoColors</span><span class="p">(</span><span class="s1">&#39;qc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="c1">#ArgoColors(&#39;qc&#39;).cmap</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;QC for Adjusted </span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39; mission&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;prefLabel&#39;</span><span class="p">],</span> <span class="n">a_param</span> <span class="o">+</span> <span class="s1">&#39;_ADJUSTED&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">mission</span><span class="p">),</span> 
             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bd08e32e8ece25e69fb508e03983ff4566b48e127e63bd10684b6ed60fe315e5.png" src="../_images/bd08e32e8ece25e69fb508e03983ff4566b48e127e63bd10684b6ed60fe315e5.png" />
</div>
</div>
</section>
</section>
<section id="splitting-data-before-training-our-model">
<h2>Splitting data before training our model.<a class="headerlink" href="#splitting-data-before-training-our-model" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>During RFR development, observations are separated into different datasets for training, validation, and testing steps (see Workflow schematic above). We note that the observations within a single glider or float profile are highly correlated; since the individual profiles are the ‘‘independent’’ units here rather than the pointwise samples, we keep observations from vertical profiles together during data splitting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare dataframe before splitting</span>
<span class="n">argodat</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">argo</span><span class="o">.</span><span class="n">point2profile</span><span class="p">()</span>
<span class="n">argodat</span> <span class="o">=</span> <span class="n">argodat</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">argodat</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Run QC</span>
<span class="n">qcvars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DOXY_ADJUSTED_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;PSAL_ADJUSTED_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;TEMP_ADJUSTED_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;PRES_ADJUSTED_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME_QC&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argodat</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; obs before QC&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argodat</span><span class="p">)</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">qcvars</span><span class="p">:</span>
    <span class="n">argodat</span> <span class="o">=</span> <span class="n">argodat</span><span class="p">[(</span><span class="n">argodat</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">argodat</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">|</span> <span class="p">(</span><span class="n">argodat</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)]</span>
    <span class="c1">#qc flag meanings           1: good data, 2: probably good data, 8: interpolated value</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after &#39;</span> <span class="o">+</span> <span class="n">var</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argodat</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; obs left   &#39;</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">argodat</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; dropped&#39;</span><span class="p">);</span> 
    <span class="n">X</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argodat</span><span class="p">)</span>

<span class="n">argodat</span><span class="o">.</span><span class="n">describe</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/sklearn-argo-dev/lib/python3.9/site-packages/argopy/xarray.py:70: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.
  self._dims = list(xarray_obj.dims.keys())
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/sklearn-argo-dev/lib/python3.9/site-packages/argopy/xarray.py:70: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.
  self._dims = list(xarray_obj.dims.keys())
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000780 obs before QC
after DOXY_ADJUSTED_QC
	276099 obs left    	1724681 dropped
after PSAL_ADJUSTED_QC
	259386 obs left    	16713 dropped
after TEMP_ADJUSTED_QC
	259386 obs left    	0 dropped
after PRES_ADJUSTED_QC
	259386 obs left    	0 dropped
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>after TIME_QC
	259386 obs left    	0 dropped
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Add training variables </span>

<span class="k">def</span> <span class="nf">datetime2ytd</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot; Return time in YTD format from datetime format.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;YD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime2ytd</span><span class="p">(</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])</span>
<span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_from_t</span><span class="p">(</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;PSAL_ADJUSTED&#39;</span><span class="p">],</span> <span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;TEMP_ADJUSTED&#39;</span><span class="p">],</span> <span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">])</span>
<span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;SA&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">SA_from_SP</span><span class="p">(</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;PSAL_ADJUSTED&#39;</span><span class="p">],</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">],</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">],</span><span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">])</span>
<span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;SIGMA0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">sigma0</span><span class="p">(</span><span class="n">argodat</span><span class="o">.</span><span class="n">SA</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">argodat</span><span class="o">.</span><span class="n">CT</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">argodat</span><span class="p">[</span><span class="s1">&#39;SPICE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">spiciness0</span><span class="p">(</span><span class="n">argodat</span><span class="o">.</span><span class="n">SA</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">argodat</span><span class="o">.</span><span class="n">CT</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">dvars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;N_PROF&#39;</span><span class="p">,</span><span class="s1">&#39;TIME&#39;</span><span class="p">,</span> <span class="s1">&#39;YD&#39;</span><span class="p">,</span> <span class="s1">&#39;LATITUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;LONGITUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">,</span><span class="s1">&#39;PSAL_ADJUSTED&#39;</span><span class="p">,</span> <span class="s1">&#39;TEMP_ADJUSTED&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;SIGMA0&#39;</span><span class="p">,</span> <span class="s1">&#39;SPICE&#39;</span><span class="p">,</span> <span class="s1">&#39;DOXY_ADJUSTED&#39;</span><span class="p">]</span>
<span class="n">argo_df</span> <span class="o">=</span> <span class="n">argodat</span><span class="p">[</span><span class="n">dvars</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">argo_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>N_PROF</th>
      <th>TIME</th>
      <th>YD</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>PRES_ADJUSTED</th>
      <th>PSAL_ADJUSTED</th>
      <th>TEMP_ADJUSTED</th>
      <th>CT</th>
      <th>SA</th>
      <th>SIGMA0</th>
      <th>SPICE</th>
      <th>DOXY_ADJUSTED</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>58</td>
      <td>2019-01-01 06:03:25.000</td>
      <td>0.252373</td>
      <td>56.933030</td>
      <td>-52.521630</td>
      <td>4.760000</td>
      <td>34.624645</td>
      <td>3.108200</td>
      <td>3.108622</td>
      <td>34.788850</td>
      <td>27.576438</td>
      <td>-0.005224</td>
      <td>313.042755</td>
    </tr>
    <tr>
      <th>1</th>
      <td>58</td>
      <td>2019-01-01 06:03:25.000</td>
      <td>0.252373</td>
      <td>56.933030</td>
      <td>-52.521630</td>
      <td>6.280000</td>
      <td>34.624847</td>
      <td>3.109900</td>
      <td>3.110227</td>
      <td>34.789055</td>
      <td>27.576450</td>
      <td>-0.004914</td>
      <td>313.051453</td>
    </tr>
    <tr>
      <th>2</th>
      <td>58</td>
      <td>2019-01-01 06:03:25.000</td>
      <td>0.252373</td>
      <td>56.933030</td>
      <td>-52.521630</td>
      <td>8.300000</td>
      <td>34.624748</td>
      <td>3.110500</td>
      <td>3.110705</td>
      <td>34.788956</td>
      <td>27.576328</td>
      <td>-0.004934</td>
      <td>313.024292</td>
    </tr>
    <tr>
      <th>4</th>
      <td>58</td>
      <td>2019-01-01 06:03:25.000</td>
      <td>0.252373</td>
      <td>56.933030</td>
      <td>-52.521630</td>
      <td>12.200000</td>
      <td>34.624748</td>
      <td>3.110800</td>
      <td>3.110767</td>
      <td>34.788964</td>
      <td>27.576328</td>
      <td>-0.004922</td>
      <td>313.263916</td>
    </tr>
    <tr>
      <th>8</th>
      <td>58</td>
      <td>2019-01-01 06:03:25.000</td>
      <td>0.252373</td>
      <td>56.933030</td>
      <td>-52.521630</td>
      <td>20.259998</td>
      <td>34.624855</td>
      <td>3.113100</td>
      <td>3.112572</td>
      <td>34.789096</td>
      <td>27.576264</td>
      <td>-0.004642</td>
      <td>312.554932</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1998670</th>
      <td>1252</td>
      <td>2022-12-30 14:35:51.036</td>
      <td>1459.608230</td>
      <td>59.672974</td>
      <td>-50.982277</td>
      <td>456.649139</td>
      <td>34.842865</td>
      <td>3.781540</td>
      <td>3.747749</td>
      <td>35.009959</td>
      <td>27.689356</td>
      <td>0.219996</td>
      <td>292.526306</td>
    </tr>
    <tr>
      <th>1998681</th>
      <td>1252</td>
      <td>2022-12-30 14:35:51.036</td>
      <td>1459.608230</td>
      <td>59.672974</td>
      <td>-50.982277</td>
      <td>465.851868</td>
      <td>34.843231</td>
      <td>3.770672</td>
      <td>3.736246</td>
      <td>35.010335</td>
      <td>27.690821</td>
      <td>0.218972</td>
      <td>292.605347</td>
    </tr>
    <tr>
      <th>1998692</th>
      <td>1252</td>
      <td>2022-12-30 14:35:51.036</td>
      <td>1459.608230</td>
      <td>59.672974</td>
      <td>-50.982277</td>
      <td>475.282532</td>
      <td>34.843609</td>
      <td>3.759535</td>
      <td>3.724458</td>
      <td>35.010722</td>
      <td>27.692322</td>
      <td>0.217925</td>
      <td>292.711700</td>
    </tr>
    <tr>
      <th>1998702</th>
      <td>1252</td>
      <td>2022-12-30 14:35:51.036</td>
      <td>1459.608230</td>
      <td>59.672974</td>
      <td>-50.982277</td>
      <td>484.937714</td>
      <td>34.843998</td>
      <td>3.748132</td>
      <td>3.712390</td>
      <td>35.011121</td>
      <td>27.693860</td>
      <td>0.216857</td>
      <td>292.717194</td>
    </tr>
    <tr>
      <th>1998713</th>
      <td>1252</td>
      <td>2022-12-30 14:35:51.036</td>
      <td>1459.608230</td>
      <td>59.672974</td>
      <td>-50.982277</td>
      <td>492.613831</td>
      <td>34.843433</td>
      <td>3.731520</td>
      <td>3.695292</td>
      <td>35.010561</td>
      <td>27.695144</td>
      <td>0.214551</td>
      <td>293.101227</td>
    </tr>
  </tbody>
</table>
<p>259386 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="begin-preparing-data-for-training">
<h2>Begin preparing data for training<a class="headerlink" href="#begin-preparing-data-for-training" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_profiles</span><span class="p">(</span><span class="n">floatDF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    @param floatDF: dataframe with all float data</span>

<span class="sd">    @return: </span>
<span class="sd">        training_data: training data (80% of profiles) with ship added</span>
<span class="sd">        validation_data: validation data (20% of profiles)</span>
<span class="sd">    </span>
<span class="sd">    This method treats a float profile like the smallest discrete &quot;unit&quot; upon which to train and validate the model.</span>
<span class="sd">    Our goal is to predict a water column (profile) rather than a discrete observation, so profiles are kept together while splitting.</span>
<span class="sd">    Note that test data will be all profiles from the SOGOS float when test_split is set as False by default.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create list of unique profile ID&#39;s and select random 80% for training</span>
    <span class="n">profnum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">floatDF</span><span class="o">.</span><span class="n">N_PROF</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> 
    <span class="n">training_pnum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">profnum</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">profnum</span><span class="p">))),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">training_data</span> <span class="o">=</span> <span class="n">floatDF</span><span class="p">[</span><span class="n">floatDF</span><span class="p">[</span><span class="s1">&#39;N_PROF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">training_pnum</span><span class="p">)]</span>

    <span class="c1"># Take HALF of remaining profiles that were not in training set, for validation (10% of total)</span>
    <span class="n">pnum_vt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">profnum</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">training_pnum</span><span class="p">]</span>  <span class="c1"># remaining profiles after training data removed</span>

    <span class="n">validation_pnum</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">pnum_vt</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pnum_vt</span><span class="p">))),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">validation_data</span> <span class="o">=</span> <span class="n">floatDF</span><span class="p">[</span><span class="n">floatDF</span><span class="p">[</span><span class="s1">&#39;N_PROF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">validation_pnum</span><span class="p">)]</span>

    <span class="n">test_pnum</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pnum_vt</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">validation_pnum</span><span class="p">]</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">floatDF</span><span class="p">[</span><span class="n">floatDF</span><span class="p">[</span><span class="s1">&#39;N_PROF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_pnum</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">training_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="p">,</span> <span class="n">test_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">training</span><span class="p">,</span> <span class="n">validation</span><span class="p">,</span> <span class="n">test</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_profiles</span><span class="p">(</span><span class="n">argo_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of total profiles: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argo_df</span><span class="o">.</span><span class="n">N_PROF</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# training observations: </span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# validation observations: </span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validation</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# test observations: </span><span class="se">\t\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># of total profiles: 1028
# training observations: 	206912
# validation observations: 	25458
# test observations: 		27016
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">training</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>N_PROF</th>
      <th>TIME</th>
      <th>YD</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>PRES_ADJUSTED</th>
      <th>PSAL_ADJUSTED</th>
      <th>TEMP_ADJUSTED</th>
      <th>CT</th>
      <th>SA</th>
      <th>SIGMA0</th>
      <th>SPICE</th>
      <th>DOXY_ADJUSTED</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>58</td>
      <td>2019-01-01 06:03:25</td>
      <td>0.252373</td>
      <td>56.93303</td>
      <td>-52.52163</td>
      <td>4.760000</td>
      <td>34.624645</td>
      <td>3.1082</td>
      <td>3.108622</td>
      <td>34.788850</td>
      <td>27.576438</td>
      <td>-0.005224</td>
      <td>313.042755</td>
    </tr>
    <tr>
      <th>1</th>
      <td>58</td>
      <td>2019-01-01 06:03:25</td>
      <td>0.252373</td>
      <td>56.93303</td>
      <td>-52.52163</td>
      <td>6.280000</td>
      <td>34.624847</td>
      <td>3.1099</td>
      <td>3.110227</td>
      <td>34.789055</td>
      <td>27.576450</td>
      <td>-0.004914</td>
      <td>313.051453</td>
    </tr>
    <tr>
      <th>2</th>
      <td>58</td>
      <td>2019-01-01 06:03:25</td>
      <td>0.252373</td>
      <td>56.93303</td>
      <td>-52.52163</td>
      <td>8.300000</td>
      <td>34.624748</td>
      <td>3.1105</td>
      <td>3.110705</td>
      <td>34.788956</td>
      <td>27.576328</td>
      <td>-0.004934</td>
      <td>313.024292</td>
    </tr>
    <tr>
      <th>4</th>
      <td>58</td>
      <td>2019-01-01 06:03:25</td>
      <td>0.252373</td>
      <td>56.93303</td>
      <td>-52.52163</td>
      <td>12.200000</td>
      <td>34.624748</td>
      <td>3.1108</td>
      <td>3.110767</td>
      <td>34.788964</td>
      <td>27.576328</td>
      <td>-0.004922</td>
      <td>313.263916</td>
    </tr>
    <tr>
      <th>8</th>
      <td>58</td>
      <td>2019-01-01 06:03:25</td>
      <td>0.252373</td>
      <td>56.93303</td>
      <td>-52.52163</td>
      <td>20.259998</td>
      <td>34.624855</td>
      <td>3.1131</td>
      <td>3.112572</td>
      <td>34.789096</td>
      <td>27.576264</td>
      <td>-0.004642</td>
      <td>312.554932</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="set-up-model-versions-to-try">
<h2>Set up model versions to try.<a class="headerlink" href="#set-up-model-versions-to-try" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>To demonstrate, we try our model on three different simple versions. Real models should use more thorough methods to determine the optimal feature list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Model_A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SPICE&#39;</span><span class="p">,</span> <span class="s1">&#39;SIGMA0&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Model_B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">],</span> 
            <span class="s1">&#39;Model_C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="s2">&quot;SA&quot;</span><span class="p">,</span> <span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">,</span> <span class="s1">&#39;YD&#39;</span><span class="p">,</span> <span class="s1">&#39;LATITUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;LONGITUDE&#39;</span><span class="p">],</span>
            <span class="p">}</span>

<span class="n">model_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">var_list</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Create dictionary of features</span>
<span class="n">allvars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">var_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">allvars</span> <span class="o">=</span> <span class="n">allvars</span> <span class="o">+</span> <span class="n">var_list</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
<span class="n">allvars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">allvars</span><span class="p">))</span> <span class="c1"># remove duplicates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">))</span>
<span class="n">model_palettes</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">pal</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<section id="main-rfr-training-method">
<h3>Main RFR training method<a class="headerlink" href="#main-rfr-training-method" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_predict</span> <span class="o">=</span> <span class="s1">&#39;DOXY_ADJUSTED&#39;</span>
<span class="k">def</span> <span class="nf">train_RFR</span><span class="p">(</span><span class="n">var_list</span><span class="p">,</span> <span class="n">training</span><span class="p">,</span> <span class="n">validation</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">ntrees</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_feats</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Main method to train the RF model.</span>
<span class="sd">    Update 04.18.24: Redo bootstrapping. </span>
<span class="sd">    @param: </span>
<span class="sd">        var_list: list of variables to use in the model</span>
<span class="sd">        training: training data unscaled, i.e. original range of values</span>
<span class="sd">        validation: validation data unscaled</span>
<span class="sd">        test: test data unscaled </span>
<span class="sd">        ntrees: 1000 trees by default.</span>

<span class="sd">    @return:</span>
<span class="sd">        Mdl: trained RF model</span>
<span class="sd">        Mdl_MAE: Rescaled mean absolute error for training, validation, and test sets</span>
<span class="sd">        Mdl_IQR: Rescaled IQR for training, validation, and test sets</span>
<span class="sd">        DF_with_error: Dataframe with error metrics for the *TEST* set</span>
<span class="sd">        validation_error: Dataframe with error metrics for the *VALIDATION* set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Mdl</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">ntrees</span><span class="p">,</span> <span class="n">max_features</span> <span class="o">=</span> <span class="n">max_feats</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">)</span>
        <span class="c1">#  max_features: use at most X features at each split (m~sqrt(total features))</span>

    <span class="c1"># Drop NaN&#39;s without profid or wmoid</span>
    <span class="n">cols_na</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">training</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;profid&#39;</span><span class="p">,</span> <span class="s1">&#39;wmoid&#39;</span><span class="p">,</span> <span class="s1">&#39;AOU&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_maxb&#39;</span><span class="p">]]</span>
    <span class="n">training_nona</span> <span class="o">=</span> <span class="n">training</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">cols_na</span><span class="p">)</span>  <span class="c1"># makes same length as training_scaled</span>
    <span class="n">validation_nona</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">cols_na</span><span class="p">)</span>
    <span class="n">test_nona</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">cols_na</span><span class="p">)</span>

    <span class="c1"># Create X Variables for each subset of data. Scale down. </span>
    <span class="n">X_training</span> <span class="o">=</span> <span class="n">training_nona</span><span class="p">[</span><span class="n">var_list</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X_validation</span> <span class="o">=</span> <span class="n">validation_nona</span><span class="p">[</span><span class="n">var_list</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_nona</span><span class="p">[</span><span class="n">var_list</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># Nitrate, the target variable. </span>
    <span class="n">Y_training</span> <span class="o">=</span> <span class="n">training_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">Y_validation</span> <span class="o">=</span> <span class="n">validation_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">Y_test</span> <span class="o">=</span> <span class="n">test_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># Train the model</span>
    <span class="n">Mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_training</span><span class="p">,</span> <span class="n">Y_training</span><span class="p">)</span>

    <span class="c1"># Estimate</span>
    <span class="n">Y_pred_training</span> <span class="o">=</span> <span class="n">Mdl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_training</span><span class="p">)</span>
    <span class="n">Y_pred_validation</span> <span class="o">=</span> <span class="n">Mdl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_validation</span><span class="p">)</span>
    <span class="n">Y_pred_test</span> <span class="o">=</span> <span class="n">Mdl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Create dataframe for the test set with depth --&gt; </span>
    <span class="n">DF_with_error</span> <span class="o">=</span> <span class="n">test_nona</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> 
    <span class="n">DF_with_error</span> <span class="o">=</span> <span class="n">DF_with_error</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">observed_nitrate</span> <span class="o">=</span> <span class="n">DF_with_error</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># Save new dataframe with test results</span>
    <span class="n">DF_with_error</span><span class="p">[</span><span class="s1">&#39;test_prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y_pred_test</span>
    <span class="n">DF_with_error</span><span class="p">[</span><span class="s1">&#39;test_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF_with_error</span><span class="p">[</span><span class="s1">&#39;test_prediction&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">observed_nitrate</span>
    <span class="n">DF_with_error</span><span class="p">[</span><span class="s1">&#39;test_relative_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF_with_error</span><span class="p">[</span><span class="s1">&#39;test_error&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">observed_nitrate</span>

    <span class="c1"># Error metrics</span>
    <span class="n">AE_RF_training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y_pred_training</span> <span class="o">-</span> <span class="n">training_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">])</span>
    <span class="n">IQR_RF_training</span> <span class="o">=</span> <span class="n">iqr</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_training</span><span class="p">))</span>
    <span class="n">r2_RF_training</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">training_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">],</span> <span class="n">Y_pred_training</span><span class="p">)</span>

    <span class="c1"># Return validation metrics</span>
    <span class="n">AE_RF_validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y_pred_validation</span> <span class="o">-</span> <span class="n">validation_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">])</span>
    <span class="n">IQR_RF_validation</span> <span class="o">=</span> <span class="n">iqr</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_validation</span><span class="p">))</span>
    <span class="n">r2_RF_validation</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">validation_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">],</span> <span class="n">Y_pred_validation</span><span class="p">)</span>

    <span class="n">validation_error</span> <span class="o">=</span> <span class="n">validation_nona</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#pd.DataFrame()</span>
    <span class="n">validation_error</span><span class="p">[</span><span class="s1">&#39;val_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y_pred_validation</span> <span class="o">-</span> <span class="n">validation_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span>
    <span class="n">validation_error</span><span class="p">[</span><span class="s1">&#39;val_relative_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_error</span><span class="p">[</span><span class="s1">&#39;val_error&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">validation_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">]</span>

    <span class="n">AE_RF_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y_pred_test</span> <span class="o">-</span> <span class="n">test_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">])</span> <span class="c1"># same as DF_with_error[&#39;test_error&#39;]</span>
    <span class="n">IQR_RF_test</span> <span class="o">=</span> <span class="n">iqr</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_test</span><span class="p">))</span>
    <span class="n">r2_RF_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">test_nona</span><span class="p">[</span><span class="n">var_predict</span><span class="p">],</span> <span class="n">Y_pred_test</span><span class="p">)</span>

    <span class="n">Mdl_MAE</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_training</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_validation</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">AE_RF_test</span><span class="p">))]</span>
    <span class="n">Mdl_IQR</span> <span class="o">=</span> <span class="p">[</span><span class="n">IQR_RF_training</span><span class="p">,</span> <span class="n">IQR_RF_validation</span><span class="p">,</span> <span class="n">IQR_RF_test</span><span class="p">]</span>
    <span class="n">Mdl_r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">r2_RF_training</span><span class="p">,</span> <span class="n">r2_RF_validation</span><span class="p">,</span> <span class="n">r2_RF_test</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">Mdl</span><span class="p">,</span> <span class="n">Mdl_MAE</span><span class="p">,</span> <span class="n">Mdl_IQR</span><span class="p">,</span> <span class="n">Mdl_r2</span><span class="p">,</span> <span class="n">DF_with_error</span><span class="p">,</span> <span class="n">validation_error</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we train the model using our main <code class="docutils literal notranslate"><span class="pre">train_RFR()</span></code> function.
Depending on your dataset size and model lists, this may take several minutes (here, about 8 minutes).</p>
<p>Note that use a relatively small number of decision tres (n=500) to speed up our example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train the models with chosen lists.</span>
<span class="c1"># Set parameters</span>
<span class="n">models</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>
<span class="n">models_MAE</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>
<span class="n">models_IQR</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>
<span class="n">models_r2</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>
<span class="n">models_DF_err</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>
<span class="n">models_val_err</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">model_list</span><span class="p">)</span>


<span class="n">ntrees</span><span class="o">=</span><span class="mi">500</span>
<span class="n">max_feats</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
<span class="n">min_samples_split</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;ntrees=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ntrees</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max_features=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_feats</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">description</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span> 
    <span class="p">[</span><span class="n">models</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">models_MAE</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">models_IQR</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">models_r2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">models_DF_err</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">models_val_err</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">train_RFR</span><span class="p">(</span><span class="n">var_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">training</span><span class="p">,</span> <span class="n">validation</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> 
                                                                                         <span class="n">ntrees</span> <span class="o">=</span> <span class="n">ntrees</span><span class="p">,</span> <span class="n">max_feats</span> <span class="o">=</span> <span class="n">max_feats</span><span class="p">,</span>
                                                                                         <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ntrees=500, max_features=0.3333333333333333
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RFR_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">models</span><span class="p">,</span> <span class="n">models_MAE</span><span class="p">,</span> <span class="n">models_IQR</span><span class="p">,</span> <span class="n">models_r2</span><span class="p">,</span> <span class="n">models_DF_err</span><span class="p">,</span> <span class="n">models_val_err</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="feature-importance">
<h2>Feature Importance<a class="headerlink" href="#feature-importance" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>RFR returns a measure for each feature called ``feature importance’’ that reflects its predictive value. For each split where a given feature is used to determine the split criterion, the difference in the variance of the pre-split node compared to the two post-split nodes is calculated (and weighted by the number of samples in the pre-split node). These values are summed across all of the relevant splits in a given decision tree; the average of these sums across all trees represents the feature importance of the given variable. The feature importances are computed for all variables used in the model, and are scaled relative to each other so that the sum of all of the final feature importances is 1. The feature importances are often screened during RFR development to help select a final set of features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allvars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SPICE&#39;</span><span class="p">,</span> <span class="s1">&#39;SIGMA0&#39;</span><span class="p">,</span> <span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;PRES_ADJUSTED&#39;</span><span class="p">,</span> <span class="s1">&#39;YD&#39;</span><span class="p">,</span> <span class="s1">&#39;LATITUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;LONGITUDE&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make total feature importance dictionary for plotting</span>
<span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">allvars</span><span class="p">)</span>
<span class="n">feat_imps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Fill in feature importance</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">vkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">[</span><span class="n">vkey</span><span class="p">]:</span>
        <span class="n">feat_imps</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">vkey</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">[</span><span class="n">var_list</span><span class="p">[</span><span class="n">vkey</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span>

<span class="c1"># feat_imps = feat_imps.set_index(&#39;Mdl&#39;).fillna(np.nan)</span>
<span class="n">feat_imps</span><span class="p">[</span><span class="s1">&#39;Mdl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_list</span>
<span class="n">feat_imps</span> <span class="o">=</span> <span class="n">feat_imps</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Mdl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">feat_imps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SPICE</th>
      <th>SIGMA0</th>
      <th>CT</th>
      <th>SA</th>
      <th>PRES_ADJUSTED</th>
      <th>YD</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
    </tr>
    <tr>
      <th>Mdl</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Model_A</th>
      <td>0.657985</td>
      <td>0.342015</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Model_B</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.426744</td>
      <td>0.345711</td>
      <td>0.227545</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Model_C</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.217725</td>
      <td>0.226726</td>
      <td>0.100598</td>
      <td>0.252884</td>
      <td>0.101309</td>
      <td>0.100759</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can compare feature importances across models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">))</span>
<span class="n">model_palettes</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">pal</span><span class="p">)}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">barwidth</span><span class="o">=</span><span class="mf">.8</span>

<span class="n">modlist</span> <span class="o">=</span> <span class="n">model_list</span>
<span class="n">varslist</span> <span class="o">=</span> <span class="n">allvars</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;spice&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;salinity&#39;</span><span class="p">,</span> <span class="s1">&#39;pres&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]</span>

<span class="c1"># Result of plot method</span>
<span class="n">xind</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">modlist</span><span class="p">)</span>
<span class="n">xind</span><span class="p">[</span><span class="n">modlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varslist</span><span class="p">))</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">modlist</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">modlist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">xind</span><span class="p">[</span><span class="n">modlist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">barwidth</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xind</span><span class="p">[</span><span class="n">modlist</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span>

<span class="k">for</span> <span class="n">modtag</span> <span class="ow">in</span> <span class="n">modlist</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xind</span><span class="p">[</span><span class="n">modtag</span><span class="p">],</span> <span class="n">feat_imps</span><span class="p">[</span><span class="n">varslist</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">modtag</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">model_palettes</span><span class="p">[</span><span class="n">modtag</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">modtag</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Feature Importances by Model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xind</span><span class="p">[</span><span class="n">modlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">varslist</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabel</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/330e528a90b7d2d7272e8e8a9b751ad7281bd695aae95bff2fc775b6d54c036b.png" src="../_images/330e528a90b7d2d7272e8e8a9b751ad7281bd695aae95bff2fc775b6d54c036b.png" />
</div>
</div>
</section>
<section id="validation-error-analysis">
<h2>Validation Error Analysis<a class="headerlink" href="#validation-error-analysis" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_model_metrics</span><span class="p">(</span><span class="n">resultlist</span><span class="p">,</span> <span class="n">mod_list</span><span class="o">=</span><span class="n">model_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    resultlist: typically list of [models, models_MAE, models_IQR, models_r2, models_DF_err]&quot;&quot;&quot;</span>
    <span class="n">models_MAE</span><span class="o">=</span><span class="n">resultlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">models_IQR</span><span class="o">=</span><span class="n">resultlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">models_r2</span><span class="o">=</span><span class="n">resultlist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">model_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;validation_MAE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models_MAE</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;validation_IQR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models_IQR</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;test_MAE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models_MAE</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;test_IQR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models_IQR</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_list</span>
    <span class="n">model_metrics</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model_metrics</span>

<span class="c1"># Method to print MAE dictionaries</span>
<span class="k">def</span> <span class="nf">print_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">  </span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">print_sorted</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">  </span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_metrics</span> <span class="o">=</span> <span class="n">get_model_metrics</span><span class="p">(</span><span class="n">RFR_results</span><span class="p">,</span> <span class="n">mod_list</span> <span class="o">=</span> <span class="n">RFR_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;validation_MAE&#39;</span><span class="p">)</span>
<span class="n">model_metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;validation_MAE&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s1">&#39;validation_MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;validation_IQR&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>validation_MAE</th>
      <th>validation_IQR</th>
    </tr>
    <tr>
      <th>model</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Model_A</th>
      <td>4.801925</td>
      <td>6.707078</td>
    </tr>
    <tr>
      <th>Model_B</th>
      <td>4.309672</td>
      <td>5.964492</td>
    </tr>
    <tr>
      <th>Model_C</th>
      <td>1.726255</td>
      <td>2.910846</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error printing methods</span>
<span class="k">def</span> <span class="nf">get_95_bounds</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">std_dev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_dev</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_dev</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">]</span>

<span class="c1"># Method to print errors restricted to depth </span>
<span class="k">def</span> <span class="nf">print_error_depths</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;test_error&#39;</span><span class="p">,</span> <span class="n">pres_lim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">]):</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">PRES_ADJUSTED</span> <span class="o">&gt;</span> <span class="n">pres_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PRES_ADJUSTED</span> <span class="o">&lt;</span> <span class="n">pres_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
   <span class="n">err</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Errors between depths &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pres_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pres_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;median abs error: </span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean abs error </span><span class="se">\t\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>

   <span class="c1"># Bounds 95</span>
   <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_95_bounds</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">95</span><span class="si">% o</span><span class="s1">f errors fall between:&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">low</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">high</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model_C&#39;</span><span class="p">)</span> <span class="c1"># leaf size: 5</span>
<span class="n">print_error_depths</span><span class="p">(</span><span class="n">RFR_results</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;Model_C&#39;</span><span class="p">],</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;val_relative_error&#39;</span><span class="p">,</span> <span class="n">pres_lim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model_C
Errors between depths 0 to 500:
median abs error: 	0.005854039676253083
mean abs error 		0.008901279112084224

95% of errors fall between:
-0.02748 to 0.02276
</pre></div>
</div>
</div>
</div>
<p>We can visualize the distribution of errors between models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;Model Validation Errors&#39;</span>
<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;val_relative_error&#39;</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">RFR_results</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">ymax</span><span class="o">=</span><span class="mi">60</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]:</span>
    <span class="n">RF</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="n">var</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">RF</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">model_palettes</span><span class="p">[</span><span class="n">mod</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Relative Error %&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Validation Error Distributions by Model&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Validation Error Distributions by Model&#39;)
</pre></div>
</div>
<img alt="../_images/ddb8655b2d41ab2079b09c3a0ce0bcaa7dbc58dfa78da1d04a6782ce7b0a8499.png" src="../_images/ddb8655b2d41ab2079b09c3a0ce0bcaa7dbc58dfa78da1d04a6782ce7b0a8499.png" />
</div>
</div>
</section>
<section id="testing-on-withheld-data">
<h2>Testing on withheld data<a class="headerlink" href="#testing-on-withheld-data" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<hr class="docutils" />
<p>This is where you begin your first section of material, loosely tied to your objectives stated up front. Tie together your notebook as a narrative, with interspersed Markdown text, images, and more as necessary,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some subsection code</span>
<span class="n">new</span> <span class="o">=</span> <span class="s2">&quot;helpful information&quot;</span>
</pre></div>
</div>
</div>
</div>
<section id="another-content-subsection">
<h3>Another content subsection<a class="headerlink" href="#another-content-subsection" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>Keep up the good work! A note, <em>try to avoid using code comments as narrative</em>, and instead let them only exist as brief clarifications where necessary.</p>
</section>
</section>
<section id="your-second-content-section">
<h2>Your second content section<a class="headerlink" href="#your-second-content-section" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Here we can move on to our second objective, and we can demonstrate</p>
<section id="subsection-to-the-second-section">
<h3>Subsection to the second section<a class="headerlink" href="#subsection-to-the-second-section" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<section id="a-quick-demonstration">
<h4>a quick demonstration<a class="headerlink" href="#a-quick-demonstration" title="Link to this heading"><i class="fas fa-link"></i></a></h4>
<section id="of-further-and-further">
<h5>of further and further<a class="headerlink" href="#of-further-and-further" title="Link to this heading"><i class="fas fa-link"></i></a></h5>
<section id="header-levels">
<h6>header levels<a class="headerlink" href="#header-levels" title="Link to this heading"><i class="fas fa-link"></i></a></h6>
<p>as well <span class="math notranslate nohighlight">\(m = a * t / h\)</span> text! Similarly, you have access to other <span class="math notranslate nohighlight">\(\LaTeX\)</span> equation <a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Typesetting%20Equations.html"><strong>functionality</strong></a> via MathJax (demo below from link),</p>
<div class="amsmath math notranslate nohighlight" id="equation-cb863afa-3bce-4f95-9ae5-638fccab3119">
<span class="eqno">(4)<a class="headerlink" href="#equation-cb863afa-3bce-4f95-9ae5-638fccab3119" title="Permalink to this equation"><i class="fas fa-link"></i></a></span>\[\begin{align}
\dot{x} &amp; = \sigma(y-x) \\
\dot{y} &amp; = \rho x - y - xz \\
\dot{z} &amp; = -\beta z + xy
\end{align}\]</div>
<p>Check out <a class="reference external" href="https://www.markdownguide.org/basic-syntax/"><strong>any number of helpful Markdown resources</strong></a> for further customizing your notebooks and the <a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Working%20With%20Markdown%20Cells.html"><strong>Jupyter docs</strong></a> for Jupyter-specific formatting information. Don’t hesitate to ask questions if you have problems getting it to look <em>just right</em>.</p>
</section>
</section>
</section>
</section>
</section>
<section id="last-section">
<h2>Last Section<a class="headerlink" href="#last-section" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>If you’re comfortable, and as we briefly used for our embedded logo up top, you can embed raw html into Jupyter Markdown cells (edit to see):</p>
<div class="admonition alert alert-info">
<p class="admonition-title">Info</p>
<p>Your relevant information here!</p>
</div>
<p>Feel free to copy this around and edit or play around with yourself. Some other <code class="docutils literal notranslate"><span class="pre">admonitions</span></code> you can put in:</p>
<div class="admonition alert alert-success">
<p class="admonition-title">Success</p>
<p>We got this done after all!</p>
</div>
<div class="admonition alert alert-warning">
<p class="admonition-title">Warning</p>
<p>Be careful!</p>
</div>
<div class="admonition alert alert-danger">
<p class="admonition-title">Danger</p>
<p>Scary stuff be here.</p>
</div>
<p>We also suggest checking out Jupyter Book’s <a class="reference external" href="https://jupyterbook.org/content/metadata.html#jupyter-cell-tags">brief demonstration</a> on adding cell tags to your cells in Jupyter Notebook, Lab, or manually. Using these cell tags can allow you to <a class="reference external" href="https://jupyterbook.org/interactive/hiding.html">customize</a> how your code content is displayed and even <a class="reference external" href="https://jupyterbook.org/content/execute.html#dealing-with-code-that-raises-errors">demonstrate errors</a> without altogether crashing our loyal army of machines!</p>
</section>
<hr class="docutils" />
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Add one final <code class="docutils literal notranslate"><span class="pre">---</span></code> marking the end of your body of content, and then conclude with a brief single paragraph summarizing at a high level the key pieces that were learned and how they tied to your objectives. Look to reiterate what the most important takeaways were.</p>
<section id="whats-next">
<h3>What’s next?<a class="headerlink" href="#whats-next" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>Let Jupyter book tie this to the next (sequential) piece of content that people could move on to down below and in the sidebar. However, if this page uniquely enables your reader to tackle other nonsequential concepts throughout this book, or even external content, link to it here!</p>
</section>
</section>
<section id="resources-and-references">
<h2>Resources and references<a class="headerlink" href="#resources-and-references" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Finally, be rigorous in your citations and references as necessary. Give credit where credit is due. Also, feel free to link to relevant external material, further reading, documentation, etc. Then you’re done! Give yourself a quick review, a high five, and send us a pull request. A few final notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Kernel</span> <span class="pre">&gt;</span> <span class="pre">Restart</span> <span class="pre">Kernel</span> <span class="pre">and</span> <span class="pre">Run</span> <span class="pre">All</span> <span class="pre">Cells...</span></code> to confirm that your notebook will cleanly run from start to finish</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Kernel</span> <span class="pre">&gt;</span> <span class="pre">Restart</span> <span class="pre">Kernel</span> <span class="pre">and</span> <span class="pre">Clear</span> <span class="pre">All</span> <span class="pre">Outputs...</span></code> before committing your notebook, our machines will do the heavy lifting</p></li>
<li><p>Take credit! Provide author contact information if you’d like; if so, consider adding information here at the bottom of your notebook</p></li>
<li><p>Give credit! Attribute appropriate authorship for referenced code, information, images, etc.</p></li>
<li><p>Only include what you’re legally allowed: <strong>no copyright infringement or plagiarism</strong></p></li>
</ul>
<p>Thank you for your contribution!</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                  </article>

                
                

                
                
                  <footer class="prev-next-footer">
                    
<div class="prev-next-area">
    <a class="left-prev"
       href="argo-access.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Accessing Argo Data</p>
      </div>
    </a>
    <a class="right-next"
       href="sklearn-clustering.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Project Pythia Notebook Template</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                  </footer>
                
              </div>

              
              
                
                  <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-background-random-forest-regression">Optional Background: Random Forest Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-spatial-and-temporal-bounds-of-argo-data">Determine spatial and temporal bounds of Argo data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fetching-data-using-argopy">Fetching data using Argopy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-example-parameter-to-visualize">Choose example parameter to visualize</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting-data-before-training-our-model">Splitting data before training our model.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#begin-preparing-data-for-training">Begin preparing data for training</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-model-versions-to-try">Set up model versions to try.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-rfr-training-method">Main RFR training method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">Feature Importance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-error-analysis">Validation Error Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-on-withheld-data">Testing on withheld data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-content-subsection">Another content subsection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-second-content-section">Your second content section</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subsection-to-the-second-section">Subsection to the second section</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-demonstration">a quick demonstration</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#of-further-and-further">of further and further</a><ul class="nav section-nav flex-column">
<li class="toc-h6 nav-item toc-entry"><a class="reference internal nav-link" href="#header-levels">header levels</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#last-section">Last Section</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#whats-next">What’s next?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-and-references">Resources and references</a></li>
</ul>
  </nav></div>

</div></div>
                
              


                
                <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://binder.projectpythia.org/v2/gh/song-sangmin/sklearn-argo/main?urlpath=lab/tree/notebooks/sklearn-regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/song-sangmin/sklearn-argo" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/song-sangmin/sklearn-argo/edit/main/notebooks/sklearn-regression.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/song-sangmin/sklearn-argo/issues/new?title=Issue%20on%20page%20%2Fnotebooks/sklearn-regression.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/sklearn-regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
            </div>

            <footer class="bd-footer-content">
              
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sangmin Song
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 14 June 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
            </footer>

        </main>
    </div>
  </div>
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
     
  
  
  
  
    <div class="footer-items__start">
      <div class="container-fluid m-0 p-0">
      
        <div class="footer-item">
  <div class="container-fluid footer-logos">
    <div class="container-xl">
      <div class="row d-flex flex-wrap align-items-center">
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="NCAR" src="../_images/NSF-NCAR_Lockup-UCAR-Dark_102523.svg" style="width: 100%">
        </div>
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="Unidata" src="../_images/Unidata_logo_horizontal_1200x300.svg" style="width: 100%">
        </div>
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="UAlbany" src="../_images/UAlbany-A2-logo-purple-gold.svg" style="width: 100%">
        </div>
      </div>
    </div>
  </div></div>
      
        <div class="footer-item">  <div class="container-fluid footer-info">
    <div class="container-xl">
      <div class="d-flex justify-content-center">
        <p class="py-1 m-0">
            &copy;&nbsp;2024.
        
          By Sangmin Song.
        
          Last updated on 14 June 2024.
        </p>
      </div>
    </div>
  </div></div>
      
        <div class="footer-item"><div class="container-fluid footer-extra">
  <div class="container">
    <center>
      Theme by <a href="https://projectpythia.org">Project Pythia</a>. All code
      in Pythia Cookbooks is licensed under
      <a href="https://opensource.org/license/apache-2-0">Apache 2.0</a>. All
      other non-code content is licensed under
      <a href="https://creativecommons.org/licenses/by/4.0/">
        Creative Commons BY 4.0 (CC BY 4.0)</a
      >.
    </center>
    <br /><br />
    <div class="row">
      <p class="m-0">
        <img
          src="../_static/footer-logo-nsf.png"
          style="float: left; width: 60px; height: 60px; margin-right: 1rem"
        />
        This material is based upon work supported by the National Science
        Foundation under Grant Nos. 2026863 and 2026899. Any opinions, findings,
        and conclusions or recommendations expressed in this material are those
        of the author(s) and do not necessarily reflect the views of the
        National Science Foundation.
      </p>
    </div>
  </div>
</div></div>
      
      </div>
    </div>
  

  </footer>
  </body>
</html>